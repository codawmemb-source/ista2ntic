<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>OFPPT - Formation Professionnelle Province de Settat</title>

<!-- Feuilles externes existantes -->
<link rel="stylesheet" href="css/style2.css">
<link rel="stylesheet" href="css/Etablissement.css" />
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
<script src="js/head-foot.js"></script>

</head>

<body>


<section class="complexes-container">
  <h1 class="section-title">Les Complexes OFPPT de la Province de Settat</h1>
  <div class="section-underline"></div>
  <div class="ofppt-brief">
    <p class="ofppt-brief__text">
      ¬´ <strong>Le p√¥le OFPPT de Settat</strong> est un centre d'excellence reconnu pour la qualit√© et la diversit√© de ses formations. Il pr√©pare une main-d'≈ìuvre qualifi√©e, op√©rationnelle et adaptable aux exigences du march√© du travail. ¬ª
    </p>
  </div>

  <div class="tabs">
    <button class="tab active" data-target="#settat">Complexe de Formation Settat</button>
    <button class="tab" data-target="#berrechid">Ecole Mohammed VI de Formation dans les M√©tiers du B√¢timent et des Travaux Publics</button>
    <button class="tab" data-target="#benahmed">Complexe de Formation Ben Ahmed</button>
  </div>

  <div class="tab-content active" id="settat">
    <div class="complex-banner settat" style="background-image: url(images/etablissement/settat/complexeSETTAT.jpeg);background-size: cover;background-position: center;height: 500px;position: relative;display: flex;align-items: center;justify-content: center;">
      <div class="overlay"></div>
      <div class="banner-text">
        <h2>Complexe De Formation Settat</h2>
        <p>√âtablissements autour de l'industrie, du digital, de la gestion, du b√¢timent et des arts culinaires.</p>
      </div>
    </div>
    <div class="establishments-grid">
      <div class="card" data-etab="ista1_settat" tabindex="0"><h3>ISTA 1 Settat</h3><p>G√©nie M√©canique, √âlectricit√©, Froid & Climatisation‚Ä¶</p></div>
      <div class="card" data-etab="ista2_settat" tabindex="0"><h3>ISTA NTIC 2 Settat</h3><p>D√©veloppement Digital, R√©seaux/Syst√®mes, Support, H√¥tellerie‚Ä¶</p></div>
      <div class="card" data-etab="ita_rahal_el_meskini" tabindex="0"><h3>ITA Rahal El Meskini</h3><p>Menuiserie, √âlectricit√© Indus., M√©canique Auto‚Ä¶</p></div>
      <div class="card" data-etab="centre_mixte_settat" tabindex="0"><h3>Centre Mixte de Formation</h3><p>Infographie, Comptabilit√©, Gestion, Petite Enfance‚Ä¶</p></div>
      <div class="card" data-etab="cqp_sidi_abdelkrim" tabindex="0"><h3>CQP Sidi Abdelkrim</h3><p>√âlectricit√© d'installation, Maintenance, S√©curit√©‚Ä¶</p></div>
    </div>
  </div>

  <div class="tab-content" id="berrechid">
    <div class="complex-banner berrechid" style="background-image: url(images/etablissement/btp/BTP1.jpg);background-size: cover;background-position: center;height: 780px;position: relative;display: flex;align-items: center;justify-content: center;">
      <div class="overlay"></div>
      <div class="banner-text">
        <h2>Ecole Mohammed VI de Formation dans les M√©tiers du B√¢timent et des Travaux Publics</h2>
        <p>Topographie/implantation, coffrage/ferraillage, gestion de chantier, HSE.</p>
      </div>
    </div>
    <div class="establishments-grid">
      <div class="card" data-etab="emfmbtp_settat" tabindex="0"><h3>Ecole Mohammed VI de Formation dans les M√©tiers du B√¢timent et des Travaux Publics</h3><p>Routes & VRD, Topo, B√¢timent, HSE‚Ä¶</p></div>
    </div>
  </div>

  <div class="tab-content" id="benahmed">
    <div class="complex-banner benahmed" style="background-image:url(images/etablissement/benahmed/BENAHMED1.jpeg);background-size: cover;background-position: center;height: 780px;position: relative;display: flex;align-items: center;justify-content: center;">
      <div class="overlay"></div>
      <div class="banner-text">
        <h2>Complexe De Formation Ben Ahmed</h2>
        <p>Cybers√©curit√©, m√©catronique, gestion des entreprises‚Ä¶</p>
      </div>
    </div>
    <div class="establishments-grid">
      <div class="card" data-etab="ista_benahmed" tabindex="0"><h3>ISTA Ben Ahmed</h3><p>Infrastructure digitale, √©lectrom√©canique, gestion‚Ä¶</p></div>
      <div class="card" data-etab="cqp_oulad_mrah" tabindex="0"><h3>CQP Oulad M'rah</h3><p>√âlec. b√¢timent, construction m√©tallique, soudage‚Ä¶</p></div>
      <div class="card" data-etab="ista_elbrouj" tabindex="0"><h3>ISTA El Borouj</h3><p>√âlectricit√©, Gestion, Menuiserie‚Ä¶</p></div>
    </div>
  </div>
</section>

<div id="etab-modal" class="etab-modal" aria-hidden="true">
  <div id="modal-backdrop" class="etab-modal__backdrop"></div>
  <div class="etab-modal__card" role="dialog" aria-modal="true" aria-labelledby="etab-title">
    <button id="modal-close" class="etab-modal__close" aria-label="Fermer">√ó</button>

    <div class="modal-head">
      <div class="head-left">
        <img id="head-thumb" class="head-thumb" alt="">
        <div class="head-meta">
          <h2 id="etab-title" class="modal-title"></h2>
          <div id="head-chips" class="head-chips"></div>
        </div>
      </div>
      <div class="modal-actions">
        <a id="btn-call" class="btn" href="#" target="_blank" rel="noopener">üìû Appeler</a>
        <a id="btn-mail" class="btn" href="#" target="_blank" rel="noopener">‚úâÔ∏è Email</a>
        <a id="btn-route" class="btn primary" href="#" target="_blank" rel="noopener">üìç Itin√©raire</a>
        <button id="btn-copy" class="btn" type="button">üìã Copier l'adresse</button>
      </div>
    </div>
    
    <section>
      <div class="modal-body oneview">
        <div class="oneview-grid">
          <!-- Colonne gauche : infos + MAP -->
          <div class="oneview-about">
            <div class="kv">
              <div class="k">ID</div><div class="v" id="kv-id"></div>
              <div class="k">Complexe</div><div class="v" id="kv-complex"></div>
              <div class="k">Adresse</div><div class="v" id="kv-address"></div>
              <div class="k">T√©l√©phone</div><div class="v" id="kv-phone"></div>
              <div class="k">Email</div><div class="v" id="kv-mail"></div>
              <div class="k">Description</div><div class="v" id="kv-desc"></div>
            </div>

            <h3 class="block-title" style="margin-top:18px;">Localisation</h3>
            <iframe
              id="map-frame"
              class="map-frame"
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
              allowfullscreen>
            </iframe>
          </div>

          <!-- Colonne droite : fili√®res + GALLERY MOVED HERE -->
          <div class="oneview-right">
            <h3 class="block-title">Fili√®res propos√©es</h3>
            <div id="fil-grid" class="fil-grid"></div>

            <!-- MOVED PREVIEW SLIDER TO HERE (REPLACED GALLERY) -->
            <div class="gallery-wrapper" id="elbroj-gallery-wrapper">
              <h3 class="block-title" style="margin-top:18px;">Galerie photo de l'√©tablissement</h3>
              <div class="preview-slider large-slider">
                <button class="slider-btn prev" id="slider-prev" type="button">&#10094;</button>
                <img id="apercu-img" class="preview-img large-preview hide" alt="">
                <button class="slider-btn next" id="slider-next" type="button">&#10095;</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<div id="img-lightbox" class="img-lightbox">
  <button class="lightbox-btn prev" id="lightbox-prev" type="button">&#10094;</button>
  <button class="lightbox-btn next" id="lightbox-next" type="button">&#10095;</button>
  <button class="lightbox-close" id="lightbox-close" type="button">&times;</button>
  <img id="img-lightbox-img" src="" alt="Aper√ßu photo √©tablissement">
</div>

<script>
window.FILIERES_BY_ETAB = {
  "NSTITUT SPECIALISE DE TECHNOLOGIE APPLIQUEE 1 SETTAT": [
    "Construction M√©tallique",
    "Froid Commercial et Climatisation",
    "Fabrication M√©canique",
    "M√©thodes en Fabrication M√©canique",
    "Assistant Administratif option Commerce",
    "Assistant Administratif option Comptabilit√©",
    "Gestion des Entreprises",
    "Gestion des Entreprises option Comptabilit√© et Finance",
    "Gestion des Entreprises option Commerce et Marketing",
    "Gestion des Entreprises option Ressources Humaines",
    "Automatisation et Instrumentation Industrielle",
    "Electricit√© de Maintenance Industrielle",
    "Electrom√©canique des Syst√®mes Automatis√©s",
    "R√©paration des engins √† moteurs option Automobile",
    "Technicien Sp√©cialis√© en Diagnostic et Electronique Embarqu√©e"
  ],
  "INSTITUT SPECIALISE DE TECHNOLOGIE APPLIQUEE 2 SETTAT": [
    "D√©veloppement Digital",
    "D√©veloppement Digital option Applications Mobiles",
    "D√©veloppement Digital option Web Full Stack",
    "Infrastructure Digitale",
    "Infrastructure Digitale option Syst√®mes et R√©seaux",
    "Arts culinaires",
    "Arts culinaires option Cuisine Gastronomique",
    "Arts culinaires option Cuisine Marocaine",
    "Agent de Restauration",
    "Management h√¥telier",
    "Management h√¥telier option Gestion h√¥teli√®re",
    "Service de Restauration ''Arts de table''",
    "Certification Microsoft office Sp√©cialiste en Excel",
    "Certification Microsoft office Specialist en Word",
    "Management de projets dans le secteur THR",
    
  ],

  "ECOLE MOHAMMED VI DE FORMATION DANS LES METIERS DU BATIMENT ET DES TRAVAUX PUBLICS SETTAT": [
    "G√©nie Civil (1√®re ann√©e)",
    "G√©nie Civil option B√¢timents (2√®me ann√©e)",
    "G√©nie Civil option Travaux Publics (2√®me ann√©e)",
    "G√©nie Civil option M√©thodes (2√®me ann√©e)",
    "G√©nie Civil option Laboratoire (2√®me ann√©e)",
    "G√©om√®tre Topographe (1√®re ann√©e)",
    "G√©om√®tre Topographe (2√®me ann√©e)",
    "Maintenance des Engins du BTP (1√®re ann√©e)",
    "Maintenance des Engins du BTP (2√®me ann√©e)",
    "B√¢timent (1√®re ann√©e)",
    "B√¢timent option M√©treur (2√®me ann√©e)",
    "B√¢timent Option Projeteur (2√®me ann√©e)",
    "Gros ≈ìuvre (1√®re ann√©e)",
    "Gros ≈ìuvre (2√®me ann√©e)",
    "Electricit√© de B√¢timent (Sp√©cialisation 1√®re ann√©e)",
    "Conducteur d'Engins BTP (1√®re ann√©e)",
    "Grutier √† Tour et Mobile (1√®re ann√©e)",
    "Maintenance des engins lourds et v√©hicules industriels (1√®re ann√©e)",
    "HSE en BTP (1√®re ann√©e)",
    "Parcours Coll√©gial Electricit√© de B√¢timent",
    "Parcours Coll√©gial Peintre",
    "Parcours Coll√©gial Plombier de b√¢timent",
    "Parcours Coll√©gial Pose de carrelage sol et mur",
    "Parcours Coll√©gial T√¢cheron"
  ],

  "INSTITUT DE TECHNOLOGIE APPLIQUEE RAHAL EL MESKINI SETTAT": [
    "Menuiserie",
    "Menuiserie Aluminium",
    "M√©canicien G√©n√©ral Polyvalent",
    "Fabrication M√©canique",
    "Electricit√© d'Entretien Industriel",
    "Electrom√©canique",
    "Electricit√© de Maintenance Industrielle",
    "Ouvrier Qualifi√© en √©lectricit√©",
    "Soudage multi proc√©d√©s",
    "R√©parateur de V√©hicules Automobiles",
    "R√©paration des engins √† moteurs option Automobile",
    "Ouvrier Sp√©cialis√© en Coupe et Couture"
  ],
  "CENTRE MIXTE DE FORMATION PROFESSIONNELLE SETTAT": [
    "Infographie",
    "Agent Socio-Educatif",
    "Assistant Administratif",
    "Assistant Administratif option Comptabilit√©",
    "Gestion des Entreprises",
    "Gestion des Entreprises option Comptabilit√© et Finance",
    "Educateur Sp√©cialis√© dans la Petite Enfance",
    "Certification Microsoft office Sp√©cialiste en Excel",
    "Certification Microsoft office Specialist en Word",
    "Coiffure Femmes"
  ],
  "INSTITUT SPECIALISE DE TECHNOLOGIE APPLIQUEE EL BROUJ": [
    "Menuiserie",
    "Menuiserie Aluminium",
    "Menuiserie option Aluminium et Bois",
    "Gestion des Entreprises",
    "Gestion des Entreprises option Comptabilit√© et Finance",
    "Electricit√© de B√¢timent",
    "Electricit√© d'Installation",
    "Electricit√© de Maintenance Industrielle",
    "R√©parateur de V√©hicules Automobiles"
  ],
  "CENTRE DE QUALIFICATION PROFESSIONNELLE OULAD MRAH": [
    "Menuiserie Aluminium",
    "Menuiserie M√©tallique",
    "Op√©rateur Polyvalent Construction M√©tallique",
    "Electricit√© de B√¢timent",
    "Electricit√© d'Installation"
  ],
  "INSTITUT SPECIALISE DE TECHNOLOGIE APPLIQUEE BEN AHMED": [
    "Op√©rateur Polyvalent Construction M√©tallique",
    "Bureau d'Etude en Construction M√©tallique",
    "Infrastructure Digitale",
    "Infrastructure Digitale option Cyber s√©curit√©",
    "Infrastructure Digitale option Syst√®mes et R√©seaux",
    "M√©canicien G√©n√©ral Polyvalent",
    "Fabrication M√©canique",
    "M√©thodes en Fabrication M√©canique",
    "Assistant Administratif",
    "Assistant Administratif option Commerce",
    "Assistant Administratif option Gestion",
    "Gestion des Entreprises",
    "Gestion des Entreprises option Comptabilit√© et Finance",
    "Gestion des Entreprises option Ressources Humaines",
    "Electricit√© d'Installation",
    "Electricit√© de Maintenance Industrielle",
    "Electrom√©canique des Syst√®mes Automatis√©s",
    "R√©parateur de V√©hicules Automobiles",
    "R√©paration des engins √† moteurs option Automobile",
    "Technicien Sp√©cialis√© en Diagnostic et Electronique Embarqu√©e",
    "Certification Microsoft office Specialist en Access",
    "Certification Microsoft office Sp√©cialiste en Excel",
    "Certification Microsoft office Sp√©cialiste en Outlook",
    "Certification Microsoft office Sp√©cialiste en PowerPoint",
    "Certification Microsoft office Specialist en Word",
    "R√©parateur de v√©hicule automobile (MAALEM)"
  ]
};

const DATA = [
  {
    id:'ista2_settat',
    name:'ISTA NTIC 2 Settat',
    summary:`Digital, r√©seaux & h√¥tellerie ‚Äì ÿ™ŸÉŸàŸäŸÜ ŸÅŸä ÿßŸÑÿ±ŸÇŸÖŸÜÿ©ÿå ÿßŸÑÿ¥ÿ®ŸÉÿßÿ™ ŸàÿßŸÑÿ≥Ÿäÿßÿ≠ÿ©.`,
    description:`L‚ÄôISTA NTIC 2 de Settat est reconnu pour ses formations dans les domaines du digital,
du d√©veloppement informatique, des r√©seaux & syst√®mes, ainsi que des m√©tiers de l‚Äôh√¥tellerie
et de la restauration. Gr√¢ce √† ses laboratoires modernes et √† une p√©dagogie orient√©e vers
l‚Äôinnovation et la pratique, l‚Äô√©tablissement pr√©pare des profils hautement qualifi√©s r√©pondant
aux besoins technologiques et touristiques du march√© national.

ÿßŸÑŸÖÿπŸáÿØ ÿßŸÑŸÖÿ™ÿÆÿµÿµ ŸÑŸÑÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ© NTIC 2 ÿ®ÿ≥ÿ∑ÿßÿ™ ŸäÿπÿØŸë ŸÖÿ±ŸÉÿ≤ÿßŸã ŸÖÿ±ÿ¨ÿπŸäÿßŸã ŸÅŸä ŸÖÿ¨ÿßŸÑÿßÿ™ ÿßŸÑÿ±ŸÇŸÖŸÜÿ©ÿå
ÿ™ÿ∑ŸàŸäÿ± ÿßŸÑÿ®ÿ±ŸÖÿ¨Ÿäÿßÿ™ÿå ÿßŸÑÿ¥ÿ®ŸÉÿßÿ™ ŸàÿßŸÑÿ£ŸÜÿ∏ŸÖÿ©ÿå ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑŸÅŸÜÿØŸÇÿ© ŸàÿßŸÑŸÖÿ∑ÿπŸÖÿ©ÿå ŸÖŸÖÿß ŸäŸÅÿ™ÿ≠ ÿ¢ŸÅÿßŸÇ ÿ•ÿØŸÖÿßÿ¨ Ÿàÿßÿ≥ÿπÿ©
ÿ£ŸÖÿßŸÖ ÿßŸÑÿÆÿ±Ÿäÿ¨ŸäŸÜ ŸÅŸä ÿ≥ŸàŸÇ ÿßŸÑÿ¥ÿ∫ŸÑ.`,
    address:"Route de Casablanca, Quartier Tanmiya,  Settat",
    phone:'05 23 40 30 84',
    email:'ista2.settat@ofppt.ma',
    image:'images/etablissement/settat/ISTA2_9.jpeg',
    programs:['D√©veloppement Digital','R√©seaux & Syst√®mes','Support Technique','H√¥tellerie-Restauration'],
    complex:'settat',
    mapUrl:'https://maps.google.com/maps?q=ISTA%20NTIC%202%20Settat&z=18&ie=UTF8&output=embed'
  },
  {
    id:'ista1_settat',
    name:'ISTA 1 Settat',
    summary:`P√¥le industriel (m√©ca, √©lectricit√©, froid) ‚Äì ŸÇÿ∑ÿ® ŸÑŸÑÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿµŸÜÿßÿπŸä.`,
    description:`L‚ÄôInstitut Sp√©cialis√© de Technologie Appliqu√©e 1 de Settat constitue l‚Äôun des centres
les plus importants de la province dans la formation technique. Il propose des sp√©cialit√©s
telles que l‚Äô√©lectricit√© industrielle, la m√©canique, la maintenance, le froid et la climatisation.
Gr√¢ce √† des ateliers √©quip√©s et une approche orient√©e vers la pratique, l‚Äôinstitut forme des
techniciens op√©rationnels capables de r√©pondre imm√©diatement aux besoins de l‚Äôindustrie.

Ÿäÿπÿ™ÿ®ÿ± ÿßŸÑŸÖÿπŸáÿØ ÿßŸÑŸÖÿ™ÿÆÿµÿµ ŸÑŸÑÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ© 1 ÿ®ÿ≥ÿ∑ÿßÿ™ ŸÇÿ∑ÿ®ÿßŸã ÿ£ÿ≥ÿßÿ≥ŸäÿßŸã ŸÑŸÑÿ™ŸÉŸàŸäŸÜ ÿßŸÑÿµŸÜÿßÿπŸäÿå ÿ≠Ÿäÿ´ ŸäŸàŸÅÿ±
ŸÖÿ≥ÿßŸÑŸÉ ŸÅŸä ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸäÿ©ÿå ÿßŸÑŸÖŸäŸÉÿßŸÜŸäŸÉÿå ÿßŸÑÿµŸäÿßŸÜÿ© ÿßŸÑÿµŸÜÿßÿπŸäÿ©ÿå ŸàÿßŸÑÿ™ÿ®ÿ±ŸäÿØ ŸàÿßŸÑÿ™ŸÉŸäŸäŸÅÿå ŸÖÿπ ÿ™ÿ±ŸÉŸäÿ≤ ŸÇŸàŸä ÿπŸÑŸâ
ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇ ÿØÿßÿÆŸÑ ÿßŸÑŸàÿ±ÿ¥ÿßÿ™.`,
    address:' Rue Des Abattoires , Zone Industrielle , Settat',
    phone:'05 23 40 30 42',
    email:'ista1.settat@ofppt.ma',
    image:'images/etablissement/settat/ista1_5.jpeg',
    programs:['G√©nie M√©canique','√âlectricit√© Industrielle','Froid et Climatisation','Maintenance Industrielle'],
    complex:'settat',
    mapUrl:'https://maps.google.com/maps?q=ISTA%201%20Settat&z=18&ie=UTF8&output=embed'
  },
  {
    id:'ita_rahal_el_meskini',
    name:'ITA Rahal El Meskini Settat',
    summary:`Menuiserie, m√©tal & auto ‚Äì ÿ™ŸÉŸàŸäŸÜ ŸÖŸáŸÜŸä ÿ™ŸÇŸÜŸä ÿ™ÿ∑ÿ®ŸäŸÇŸä.`,
    description:`L‚ÄôInstitut de Technologie Appliqu√©e Rahal El Meskini offre une formation professionnelle
technique orient√©e vers la menuiserie aluminium, la construction m√©tallique, la m√©canique
automobile et l‚Äô√©lectricit√© industrielle. L‚Äô√©tablissement privil√©gie l‚Äôapprentissage pratique
en atelier afin de permettre une insertion rapide et efficace sur le march√© du travail.

ŸäŸàŸÅÿ± ŸÖÿπŸáÿØ ÿßŸÑÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ© ÿ±ÿ≠ÿßŸÑ ÿßŸÑŸÖÿ≥ŸÉŸäŸÜŸä ÿ™ŸÉŸàŸäŸÜÿßÿ™ ÿ™ŸÇŸÜŸäÿ© ŸÅŸä ÿßŸÑŸÜÿ¨ÿßÿ±ÿ© ÿßŸÑÿ£ŸÑŸÖŸÜŸäŸàŸÖÿå ÿßŸÑÿ®ŸÜÿßÿ°
ÿßŸÑŸÖŸäÿ™ÿßŸÑŸÄŸäÿå ÿßŸÑŸÖŸäŸÉÿßŸÜŸäŸÉ ÿßŸÑÿ≥Ÿäÿßÿ±ÿßÿ™ÿå ŸàÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ° ÿßŸÑÿµŸÜÿßÿπŸäÿ©ÿå ŸÖÿπ ÿ™ÿ±ŸÉŸäÿ≤ ŸÉÿ®Ÿäÿ± ÿπŸÑŸâ ÿßŸÑÿ™ÿπŸÑŸÖ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸä
ÿØÿßÿÆŸÑ ÿßŸÑŸàÿ±ÿ¥ÿßÿ™ ŸÑÿ∂ŸÖÿßŸÜ ÿ•ÿØŸÖÿßÿ¨ ŸÖŸáŸÜŸä ÿ≥ÿ±Ÿäÿπ.`,
    address:'Avenue Rahal El Meskini, Settat',
    phone:'05 23 72 07 11',
    email:'it.rahal@ofppt.ma',
    image:'images/etablissement/settat/ista1_5.jpeg',
    programs:['Menuiserie Aluminium','√âlectricit√© Industrielle','M√©canique Automobile','Construction M√©tallique'],
    complex:'settat',
    mapUrl:'https://maps.google.com/maps?q=ITA%20Rahal%20El%20Meskini%20Settat&z=18&ie=UTF8&output=embed'
  },
  {
    id:'centre_mixte_settat',
    name:'Centre Mixte de Formation Professionnelle Settat',
    summary:`Administration, services & petite enfance ‚Äì ÿ™ŸÉŸàŸäŸÜ ÿ•ÿØÿßÿ±Ÿä ŸàÿÆÿØŸÖÿßÿ™Ÿä.`,
    description:`Le Centre Mixte de Settat propose des formations sp√©cialis√©es dans les domaines
administratifs, sociaux et cr√©atifs, dont l‚Äôinfographie, la comptabilit√©, la gestion
d‚Äôentreprise et l‚Äô√©ducation de la petite enfance. Gr√¢ce √† un encadrement personnalis√©,
l‚Äô√©tablissement contribue au d√©veloppement de profils polyvalents adapt√©s au secteur
des services.

ŸäŸÇÿØŸÖ ÿßŸÑŸÖÿ±ŸÉÿ≤ ÿßŸÑŸÖÿÆÿ™ŸÑÿ∑ ŸÑŸÑÿ™ŸÉŸàŸäŸÜ ÿßŸÑŸÖŸáŸÜŸä ÿ®ÿ≥ÿ∑ÿßÿ™ ŸÖÿ≥ÿßŸÑŸÉ ŸÅŸä ÿßŸÑÿ•ÿπŸÑÿßŸÖŸäÿßÿ™ ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ©ÿå ÿßŸÑŸÖÿ≠ÿßÿ≥ÿ®ÿ©ÿå ÿ™ÿ≥ŸäŸäÿ±
ÿßŸÑŸÖŸÇÿßŸàŸÑÿßÿ™ÿå Ÿàÿ™ÿ±ÿ®Ÿäÿ© ÿßŸÑÿ∑ŸÅŸàŸÑÿ© ÿßŸÑŸÖÿ®ŸÉÿ±ÿ©ÿå ŸÖÿπ ŸÖŸàÿßŸÉÿ®ÿ© ŸÅÿ±ÿØŸäÿ© ÿ™ŸáÿØŸÅ ÿ•ŸÑŸâ ÿ•ÿπÿØÿßÿØ ŸÖÿ™ÿØÿ±ÿ®ŸäŸÜ ÿ∞ŸàŸä ŸÉŸÅÿßÿ°ÿßÿ™
ŸÖÿ™ÿπÿØÿØÿ© ŸÅŸä ŸÖŸáŸÜ ÿßŸÑÿÆÿØŸÖÿßÿ™.`,
    address:'Centre-ville de Settat, Boulevard colonel Salah-Eddine',
    phone:'05 23 40 05 59',
    email:'centre.mixte@ofppt.ma',
    image:'images/etablissement/settat/ista1_5.jpeg',
    programs:['Infographie','Comptabilit√©','Gestion d‚ÄôEntreprise','Petite Enfance'],
    complex:'settat',
    mapUrl:'https://maps.google.com/maps?q=Centre%20Mixte%20de%20Formation%20Professionnelle%20Settat&z=18&ie=UTF8&output=embed'
  },
  {
    id:'cqp_sidi_abdelkrim',
    name:'CQP Sidi Abdelkrim (OFPPT) Settat',
    summary:`√âlectricit√© & maintenance ‚Äì ŸÖÿ±ŸÉÿ≤ ŸÑŸÑÿ™ÿ£ŸáŸäŸÑ ÿßŸÑÿ≥ÿ±Ÿäÿπ ŸÜÿ≠Ÿà ÿßŸÑÿ¥ÿ∫ŸÑ.`,
    description:`Le Centre de Qualification Professionnelle Sidi Abdelkrim forme des techniciens qualifi√©s
dans l‚Äô√©lectricit√© d‚Äôinstallation, la maintenance industrielle et la s√©curit√© au travail.
Con√ßu pour faciliter l‚Äôentr√©e rapide sur le march√© de l‚Äôemploi, il accueille aussi bien des
jeunes que des adultes souhaitant se former ou se reconvertir.

Ÿäÿ±ŸÉÿ≤ ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ™ÿ£ŸáŸäŸÑ ÿßŸÑŸÖŸáŸÜŸä ÿ≥ŸäÿØŸä ÿπÿ®ÿØ ÿßŸÑŸÉÿ±ŸäŸÖ ÿπŸÑŸâ ÿ™ŸÉŸàŸäŸÜÿßÿ™ ŸÅŸä ŸÉŸáÿ±ÿ®ÿßÿ° ÿßŸÑÿ•ŸÜÿ¥ÿßÿ°ÿßÿ™ÿå ÿßŸÑÿµŸäÿßŸÜÿ© ÿßŸÑÿµŸÜÿßÿπŸäÿ©
Ÿàÿ≥ŸÑÿßŸÖÿ© ÿßŸÑÿπŸÖŸÑÿå ŸÖÿπ ÿ®ÿ±ÿßŸÖÿ¨ ŸÖŸÑÿßÿ¶ŸÖÿ© ŸÑŸÑÿ¥ÿ®ÿßÿ® ŸàÿßŸÑÿ±ÿßÿ¥ÿØŸäŸÜ ÿßŸÑÿ±ÿßÿ∫ÿ®ŸäŸÜ ŸÅŸä ÿßŸÉÿ™ÿ≥ÿßÿ® ŸÖŸáŸÜÿ© ŸÅŸä ŸàŸÇÿ™ Ÿàÿ¨Ÿäÿ≤.`,
    address:' quartier Sidi Abdelkrim, Settat',
    phone:'05 23 40 08 59',
    email:'cqp.sidiabdelkrim@ofppt.ma',
    image:'images/etablissement/settat/CQP1.png',
    programs:['√âlectricit√© d‚ÄôInstallation','Maintenance Industrielle','S√©curit√© au Travail'],
    complex:'settat',
    mapUrl:'https://maps.google.com/maps?q=CQP%20Sidi%20Abdelkrim%20Settat&z=18&ie=UTF8&output=embed'
  },
  {
    id:'ista_benahmed',
    name:'ISTA Ben Ahmed',
    summary:`Infrastructure digitale & gestion ‚Äì ÿ™ŸÉŸàŸäŸÜ ÿ≠ÿØŸäÿ´ ŸÑÿÆÿØŸÖÿ© ÿßŸÑŸÖŸÇÿßŸàŸÑÿßÿ™.`,
    description:`L‚ÄôInstitut Sp√©cialis√© de Technologie Appliqu√©e de Ben Ahmed propose une offre diversifi√©e
regroupant l‚Äôinfrastructure digitale, l‚Äô√©lectrom√©canique, la gestion d‚Äôentreprise et la
cybers√©curit√©. Gr√¢ce √† une p√©dagogie moderne et des √©quipements adapt√©s, il pr√©pare une
nouvelle g√©n√©ration de techniciens qualifi√©s r√©pondant aux besoins des entreprises locales
et nationales.

ŸäŸàŸÅÿ± ÿßŸÑŸÖÿπŸáÿØ ÿßŸÑŸÖÿ™ÿÆÿµÿµ ŸÑŸÑÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ© ÿ®ÿ®ŸÜ ÿ£ÿ≠ŸÖÿØ ÿ™ŸÉŸàŸäŸÜÿßÿ™ ŸÅŸä ÿßŸÑÿ®ŸÜŸäÿßÿ™ ÿßŸÑÿ™ÿ≠ÿ™Ÿäÿ© ÿßŸÑÿ±ŸÇŸÖŸäÿ©ÿå
ÿßŸÑÿ•ŸÑŸÉÿ™ÿ±ŸàŸÄŸÖŸäŸÉÿßŸÜŸäŸÉÿå ÿ™ÿ≥ŸäŸäÿ± ÿßŸÑŸÖŸÇÿßŸàŸÑÿßÿ™ ŸàÿßŸÑÿ£ŸÖŸÜ ÿßŸÑÿ≥Ÿäÿ®ÿ±ÿßŸÜŸäÿå ÿ®ŸáÿØŸÅ ÿ™ÿ£ŸáŸäŸÑ ÿ£ÿ∑ÿ± ŸÇÿßÿØÿ±ÿ© ÿπŸÑŸâ ŸÖŸàÿßŸÉÿ®ÿ©
ŸÖÿ™ÿ∑ŸÑÿ®ÿßÿ™ ÿ≥ŸàŸÇ ÿßŸÑÿ¥ÿ∫ŸÑ.`,
    address:'Quartier Administratif, ville de Ben Ahmed',
    phone:'05 23 40 78 45',
    email:'ista.benahmed@ofppt.ma',
    image:'images/etablissement/benahmed/BENAHMED1.jpeg',
    programs:['Infrastructure Digitale','√âlectrom√©canique','Gestion PME-PMI','Cybers√©curit√©'],
    complex:'benahmed',
    mapUrl:'https://maps.google.com/maps?q=ISTA%20Ben%20Ahmed&z=18&ie=UTF8&output=embed'
  },
  {
    id:'cqp_oulad_mrah',
    name:'CQP Oulad M‚Äôrah (OFPPT)',
    summary:`Soudage, construction m√©tallique & √©lectricit√© ‚Äì ÿ™ŸÉŸàŸäŸÜ ŸÖŸáŸÜŸä ŸÇÿ±Ÿäÿ® de l'environnement rural.`,
    description:`Le Centre de Qualification Professionnelle d‚ÄôOulad M‚Äôrah offre des formations directement
ax√©es sur la pratique dans le domaine du soudage, de la construction m√©tallique et de
l‚Äô√©lectricit√© b√¢timent. Il constitue un levier important pour l‚Äôinsertion professionnelle
locale, notamment en milieu semi-rural.

ŸäŸàŸÅÿ± ŸÖÿ±ŸÉÿ≤ ÿßŸÑÿ™ÿ£ŸáŸäŸÑ ÿßŸÑŸÖŸáŸÜŸä ÿ®ÿ£ŸàŸÑÿßÿØ ŸÖÿ±ÿßÿ≠ ÿ™ŸÉŸàŸäŸÜÿßÿ™ ÿ™ÿ∑ÿ®ŸäŸÇŸäÿ© ŸÅŸä ÿßŸÑŸÑÿ≠ÿßŸÖÿå ÿßŸÑÿ®ŸÜÿßÿ° ÿßŸÑŸÖŸäÿ™ÿßŸÑŸÄŸä ŸàŸÉŸáÿ±ÿ®ÿßÿ°
ÿßŸÑÿ®ŸÜÿßÿ°ÿå ŸÖŸÖÿß Ÿäÿ≥ÿßŸáŸÖ ŸÅŸä ÿ™ÿ≠ÿ≥ŸäŸÜ ŸÅÿ±ÿµ ÿßŸÑÿ™ÿ¥ÿ∫ŸäŸÑ ÿØÿßÿÆŸÑ ÿßŸÑŸàÿ≥ÿ∑ ÿßŸÑŸÇÿ±ŸàŸä ŸàÿßŸÑŸÖŸÜÿßÿ∑ŸÇ ÿßŸÑŸÖÿ¨ÿßŸàÿ±ÿ©.`,
    address:'Commune rurale Oulad M‚Äôrah, Oulad M‚Äôrah, province de Settat',
    phone:'05 23 40 30 30',
    email:'cqp.ouladmrah@ofppt.ma',
    image:'images/etablissement/settat/CQP1.png',
    programs:['√âlectricit√© B√¢timent','Construction M√©tallique','Soudage'],
    complex:'benahmed',
    mapUrl:'https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3203.8609857907036!2d-7.2765111421833355!3d32.91389036722145!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0xda677785dc00001%3A0xd2ccfdce8d143d33!2sCentre%20de%20Qualification!5e1!3m2!1sfr!2sma!4v1763908037375!5m2!1sfr!2sma'
  },
  {
    id:'emfmbtp_settat',
    name:'EMFMBTP ‚Äì √âcole Mohammed VI des M√©tiers du BTP (Settat)',
    summary:`P√¥le BTP, g√©nie civil & HSE ‚Äì ŸÖÿØÿ±ÿ≥ÿ© ÿ±ÿßÿ¶ÿØÿ© ŸÅŸä ŸÖŸáŸÜ ÿßŸÑÿ®ŸÜÿßÿ° ŸàÿßŸÑÿ£ÿ¥ÿ∫ÿßŸÑ ÿßŸÑÿπŸÖŸàŸÖŸäÿ©.`,
    description:`L‚Äô√âcole Mohammed VI des M√©tiers du B√¢timent et des Travaux Publics constitue un p√¥le
d‚Äôexcellence dans les formations li√©es au g√©nie civil, √† la topographie, √† la gestion de
chantier, √† la VRD et √† la s√©curit√© industrielle. Son infrastructure modernis√©e permet une
formation sp√©cialis√©e adapt√©e aux besoins du secteur BTP.

ÿ™ÿπÿØ ŸÖÿØÿ±ÿ≥ÿ© ŸÖÿ≠ŸÖÿØ ÿßŸÑÿ≥ÿßÿØÿ≥ ŸÑŸÖŸáŸÜ ÿßŸÑÿ®ŸÜÿßÿ° ŸàÿßŸÑÿ£ÿ¥ÿ∫ÿßŸÑ ÿßŸÑÿπŸÖŸàŸÖŸäÿ© ŸÖÿ±ŸÉÿ≤ÿßŸã ŸÖÿ™ŸÖŸäÿ≤ÿßŸã ŸÑŸÑÿ™ŸÉŸàŸäŸÜ ŸÅŸä ŸáŸÜÿØÿ≥ÿ©
ÿßŸÑŸÖÿØŸÜŸäÿ©ÿå ÿßŸÑÿ∑ÿ®Ÿàÿ∫ÿ±ÿßŸÅŸäÿßÿå ÿ™ÿØÿ®Ÿäÿ± ÿßŸÑÿ£Ÿàÿ±ÿßÿ¥ÿå ÿßŸÑÿ∑ÿ±ŸÇ ŸàÿßŸÑÿ¥ÿ®ŸÉÿßÿ™ÿå ÿ•ÿ∂ÿßŸÅÿ© ÿ•ŸÑŸâ ÿßŸÑÿ≥ŸÑÿßŸÖÿ© ÿßŸÑŸÖŸáŸÜŸäÿ©ÿå ŸÖÿπ ÿ™ÿ¨ŸáŸäÿ≤ÿßÿ™
ÿ≠ÿØŸäÿ´ÿ© ÿ™ÿ≠ÿßŸÉŸä ŸàÿßŸÇÿπ ÿßŸÑŸÖŸÇÿßŸàŸÑÿßÿ™ ÿßŸÑÿπÿßŸÖŸÑÿ© ŸÅŸä ÿßŸÑŸÇÿ∑ÿßÿπ.`,
    address:'Douar Laamamcha, commune Mzamza Al Janoubia, province de Settat',
    phone:'05 22 63 45 47',
    email:'emfmbtp@ofppt.ma',
    image:'images/etablissement/btp/BTP1.jpg',
    programs:['B√¢timent','Travaux Publics','Topographie','Gestion de Chantier','VRD','Maintenance d‚ÄôEngins'],
    complex:'settat',
    mapUrl:'https://maps.google.com/maps?q=EMFMBTP%20Settat&z=18&ie=UTF8&output=embed'
  },
  {
    id:'ista_elbrouj',
    name:'ISTA El Borouj',
    summary:`√âlectricit√©, gestion & menuiserie ‚Äì ÿ•ÿØŸÖÿßÿ¨ ŸÖŸáŸÜŸä ŸÑÿÆÿØŸÖÿ© ÿßŸÑŸÖŸÜÿ∑ŸÇÿ©.`,
    description:`L‚ÄôInstitut Sp√©cialis√© de Technologie Appliqu√©e El Borouj propose des formations en
√©lectricit√©, en gestion et en menuiserie. L‚Äô√©tablissement contribue au d√©veloppement de
comp√©tences adapt√©es aux besoins socio-√©conomiques de la r√©gion, facilitant l‚Äôinsertion
professionnelle locale.

ŸäŸàŸÅÿ± ÿßŸÑŸÖÿπŸáÿØ ÿßŸÑŸÖÿ™ÿÆÿµÿµ ŸÑŸÑÿ™ŸÉŸÜŸàŸÑŸàÿ¨Ÿäÿß ÿßŸÑÿ™ÿ∑ÿ®ŸäŸÇŸäÿ© ÿ®ÿßŸÑÿ®ÿ±Ÿàÿ¨ ŸÖÿ≥ÿßŸÑŸÉ ŸÅŸä ÿßŸÑŸÉŸáÿ±ÿ®ÿßÿ°ÿå ÿ™ÿ≥ŸäŸäÿ± ÿßŸÑŸÖŸÇÿßŸàŸÑÿßÿ™
ŸàÿßŸÑŸÜÿ¨ÿßÿ±ÿ©ÿå ŸÖŸÖÿß Ÿäÿ≥ÿßÿπÿØ ÿπŸÑŸâ ÿ™ÿ£ŸáŸäŸÑ ÿ¥ÿ®ÿßÿ® ÿßŸÑŸÖŸÜÿ∑ŸÇÿ© ŸÑŸÑÿßŸÜÿØŸÖÿßÿ¨ ŸÅŸä ÿßŸÑŸÜÿ≥Ÿäÿ¨ ÿßŸÑÿßŸÇÿ™ÿµÿßÿØŸä ÿßŸÑŸÖÿ≠ŸÑŸä.`,
    address:'Quartier Administratif, centre-ville El Borouj, province de Settat',
    phone:'05 24 23 13 07',
    email:'ista.elbrouj@ofppt.ma',
    image:'images/etablissement/benahmed/BROUJ1.jpeg',   
    programs:['√âlectricit√© Industrielle','Gestion PME-PMI','Menuiserie Bois'],
    complex:'benahmed',
    mapUrl:'https://maps.google.com/maps?q=ISTA%20El%20Borouj&z=18&ie=UTF8&output=embed'
  }
];

const ETAB_KEY_MAP = {
  ista1_settat: 'NSTITUT SPECIALISE DE TECHNOLOGIE APPLIQUEE 1 SETTAT', 
  ista2_settat: 'INSTITUT SPECIALISE DE TECHNOLOGIE APPLIQUEE 2 SETTAT',
  emfmbtp_settat: 'ECOLE MOHAMMED VI DE FORMATION DANS LES METIERS DU BATIMENT ET DES TRAVAUX PUBLICS SETTAT',
  ita_rahal_el_meskini: 'INSTITUT DE TECHNOLOGIE APPLIQUEE RAHAL EL MESKINI SETTAT',
  centre_mixte_settat: 'CENTRE MIXTE DE FORMATION PROFESSIONNELLE SETTAT',
  ista_elbrouj: 'INSTITUT SPECIALISE DE TECHNOLOGIE APPLIQUEE EL BROUJ',
  cqp_oulad_mrah: 'CENTRE DE QUALIFICATION PROFESSIONNELLE OULAD MRAH',
  ista_benahmed: 'INSTITUT SPECIALISE DE TECHNOLOGIE APPLIQUEE BEN AHMED'
};

const SECTOR_RULES = [
  { rx: /(d√©veloppement|infrastructure|r√©seaux|syst√®mes|cyber|digital|microsoft|support)/i, sector: "Digital & IT" },
  { rx: /(gestion|administratif|comptabilit|marketing|ressources humaines|assistant)/i, sector: "Gestion & Administration" },
  { rx: /(√©lectricit|√©lectrom√©canique|automatis|instrumentation|syst(√®|e)mes automatis|maintenance industrielle)/i, sector: "√âlectricit√© & Automatismes" },
  { rx: /(fabrication m√©canique|m√©canique|construction m√©tallique|soudage|bureau d'?√©tude)/i, sector: "M√©canique & M√©tal" },
  { rx: /(froid|climatisation)/i, sector: "Froid & Climatisation" },
  { rx: /(r√©parat(eur|rice)|engins|automobile|diagnostic|embarqu√©e)/i, sector: "Automobile" },
  { rx: /(b√¢timent|g(√©|e)nie civil|gros ≈ìuvres|topograph|vrd|grutier|m(√©|e)treur|voirie|carrelage|hse)/i, sector: "BTP & G√©nie civil" },
  { rx: /(arts culinaires|restauration|housekeeping|h(√¥|o)teli)/i, sector: "Tourisme & H√¥tellerie-Restauration" },
  { rx: /(infograph|coiffure|petite enfance|agent socio|menuiserie|couture|formation qualifiante)/i, sector: "Services & M√©tiers" }
];

function sectorsFromPrograms(programs = []) {
  const found = new Set();
  for (const p of programs) {
    for (const rule of SECTOR_RULES) {
      if (rule.rx.test(p)) found.add(rule.sector);
    }
  }
  return Array.from(found).sort((a,b)=>a.localeCompare(b,'fr'));
}

const $ = (s,root=document)=>root.querySelector(s);
const tel = v => 'tel:'+String(v||'').replace(/\s+/g,'');
const mail = v => 'mailto:'+(v||'');

const gmapDir = e => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.address||'')}`;

const gmapEmbed = (e) => {
  if (e.mapUrl) { try { return new URL(e.mapUrl).toString(); } catch {} }
  const parts = [e.name, e.address, 'Settat, Maroc'].filter(Boolean).join(', ');
  const q = encodeURIComponent(parts);
  return `https://maps.google.com/maps?q=${q}&z=18&ie=UTF8&output=embed`;
};

function attachFilieresFromSource(etab){
  const src = window.FILIERES_BY_ETAB || {};
  const key = ETAB_KEY_MAP[etab.id];
  const list = key && src[key];
  if (Array.isArray(list) && list.length){
    const unique = Array.from(new Set(list.map(s => String(s).trim()))).sort((a,b)=>a.localeCompare(b,'fr'));
    etab.programs = unique;
  }
}

const modal = $('#etab-modal');
const backdrop = $('#modal-backdrop');
const closeBtn = $('#modal-close');

const M = {
  title: $('#etab-title'),
  call:  $('#btn-call'),
  mail:  $('#btn-mail'),
  route: $('#btn-route'),
  copy:  $('#btn-copy'),
  headThumb: $('#head-thumb'),
  headChips: $('#head-chips'),
  img:   $('#apercu-img'),
  kvId:  $('#kv-id'),
  kvCx:  $('#kv-complex'),
  kvAdr: $('#kv-address'),
  kvPh:  $('#kv-phone'),
  kvMl:  $('#kv-mail'),
  kvDs:  $('#kv-desc'),
  filGrid: $('#fil-grid'),
  map:   $('#map-frame'),
  elbWrap: $('#elbroj-gallery-wrapper'),
  lb: $('#img-lightbox'),
  lbImg: $('#img-lightbox-img'),
  sliderPrev: $('#slider-prev'),
  sliderNext: $('#slider-next'),
  lightboxPrev: $('#lightbox-prev'),
  lightboxNext: $('#lightbox-next'),
  lightboxClose: $('#lightbox-close')
};
let currentPhotos = [];
let currentPhotoIndex = 0;

function updateSlider() {
  if (!M.img) return;

  if (!currentPhotos || !currentPhotos.length) {
    M.img.classList.add('hide');
    if (M.sliderPrev) M.sliderPrev.style.display = 'none';
    if (M.sliderNext) M.sliderNext.style.display = 'none';
    return;
  }

  // s√©curit√© au cas o√π
  if (currentPhotoIndex < 0 || currentPhotoIndex >= currentPhotos.length) {
    currentPhotoIndex = 0;
  }

  const alt = M.title ? (M.title.textContent || 'Photo √©tablissement') : 'Photo √©tablissement';
  setImgSafe(M.img, currentPhotos[currentPhotoIndex], alt);
  M.img.classList.remove('hide');

  const showControls = currentPhotos.length > 1;
  if (M.sliderPrev) M.sliderPrev.style.display = showControls ? 'flex' : 'none';
  if (M.sliderNext) M.sliderNext.style.display = showControls ? 'flex' : 'none';
}

function setSliderPhotos(photosArr, fallbackImage, alt) {
  if (Array.isArray(photosArr) && photosArr.length) {
    currentPhotos = photosArr.slice();
  } else if (fallbackImage) {
    currentPhotos = [fallbackImage];
  } else {
    currentPhotos = [];
  }
  currentPhotoIndex = 0;
  updateSlider();
}

if (M.sliderPrev && M.sliderNext) {
  M.sliderPrev.addEventListener('click', () => {
    if (!currentPhotos.length) return;
    currentPhotoIndex = (currentPhotoIndex - 1 + currentPhotos.length) % currentPhotos.length;
    updateSlider();
  });

  M.sliderNext.addEventListener('click', () => {
    if (!currentPhotos.length) return;
    currentPhotoIndex = (currentPhotoIndex + 1) % currentPhotos.length;
    updateSlider();
  });
}

function setImgSafe(el, src, altText){
  if (!el) return;
  el.loading = 'lazy';
  el.decoding = 'async';
  el.referrerPolicy = 'no-referrer';
  el.onerror = () => {
    el.removeAttribute('src');
    const svg = encodeURIComponent(
      `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 300 300'>
         <rect width='100%' height='100%' fill='#eef1f6'/>
         <g fill='#cdd6e3'>
           <rect x='30' y='40' width='240' height='160' rx='12'/>
           <circle cx='120' cy='120' r='28'/>
           <rect x='30' y='220' width='180' height='160' rx='8'/>
         </g>
       </svg>`
    );
    el.style.backgroundImage = `url("data:image/svg+xml,${svg}")`;
    el.style.backgroundSize = 'cover';
    el.style.backgroundPosition = 'center';
  };
  el.src = src || '';
  el.alt = (altText || 'photo');
}

function openById(id){
  const e = DATA.find(x=>x.id===id); if(!e) return;

  attachFilieresFromSource(e);
  currentPhotos = [];
  currentPhotoIndex = 0;

  const sectors = sectorsFromPrograms(e.programs || []);
  M.headChips.innerHTML = (sectors.length ? sectors : ["Secteur non renseign√©"])
    .slice(0,6)
    .map(s=>`<span class="chip">${s}</span>`).join('');

  M.title.textContent = e.name || '';

  M.call.href  = tel(e.phone);
  M.mail.href  = mail(e.email);
  M.route.href = gmapDir(e);
  M.copy.onclick = async ()=>{
    try {
      await navigator.clipboard.writeText(e.address||'');
      M.copy.textContent='‚úî Copi√©';
      setTimeout(()=>M.copy.textContent='üìã Copier l‚Äôadresse',1200);
    } catch(_){
      alert('Adresse copi√©e : '+(e.address||''));
    }
  };

  // Fix image path for headThumb based on establishment ID
  let headThumbSrc = e.image;

  // Map each establishment to its correct image path
  const imagePathMap = {
      'ista1_settat': 'images/etablissement/settat/ista1_5.jpeg',
      'ista2_settat': 'images/etablissement/settat/ISTA2_7.jpeg',
      'ita_rahal_el_meskini': 'images/header/ofppt-logo1.svg',
      'centre_mixte_settat': 'images/etablissement/settat/CM1.jpg',
      'cqp_sidi_abdelkrim': 'images/header/ofppt-logo1.svg',
      'ista_benahmed': 'images/etablissement/benahmed/BENAHMED1.jpeg',
      'cqp_oulad_mrah': 'images/etablissement/settat/CQP1.png',
      'emfmbtp_settat': 'images/etablissement/btp/BTP1.jpg',
      'ista_elbrouj': 'images/etablissement/benahmed/BROUJ1.jpeg'
  };

  // Use the mapped path or fallback to the original image
  headThumbSrc = imagePathMap[e.id] || e.image;

  setImgSafe(M.headThumb, headThumbSrc, e.name);

  M.kvId.textContent  = e.id || '';
  M.kvCx.textContent  = (e.complex||'').toUpperCase();
  M.kvAdr.textContent = e.address || '';
  M.kvPh.innerHTML    = e.phone ? `<a href="${tel(e.phone)}">${e.phone}</a>` : '‚Äî';
  M.kvMl.innerHTML    = e.email ? `<a href="${mail(e.email)}">${e.email}</a>` : '‚Äî';

  // FR + AR : s√©paration automatique en blocs avec badges
  const rawDesc = e.description || '';
  const lines = rawDesc.split('\n').filter(l => l.trim() !== '');
  M.kvDs.innerHTML = lines.map(line => {
    const isArabic = /[\u0600-\u06FF]/.test(line);
    const cls = isArabic ? 'ar' : 'fr';
    return `<p class="${cls}">${line}</p>`;
  }).join('');

  M.filGrid.innerHTML = (e.programs||[]).map(p=>`<div class="fil-item">${p}</div>`).join('') || '<em>Aucune fili√®re renseign√©e.</em>';

  M.map.src = gmapEmbed(e);

  // Galerie photo (ISTA El Borouj, ISTA Ben Ahmed, CQP Oulad M'rah, EMFMBTP, ...)
  if (M.elbWrap) {
    let photos = [];

    if (e.id === 'ista_elbrouj') {
      photos = [
        'images/etablissement/benahmed/BROUJ1.jpeg',
        'images/etablissement/benahmed/BROUJ2.jpg',
        'images/etablissement/benahmed/BROUJ3.jpg',
        'images/etablissement/benahmed/BROUJ4.jpg',
        'images/etablissement/benahmed/BROUJ5.jpg'
      ];
    } else if (e.id === 'ista_benahmed') {
      photos = [
        'images/etablissement/benahmed/BENAHMED1.jpeg',
        'images/etablissement/benahmed/BENAHMED2.jpeg',
        'images/etablissement/benahmed/BENAHMED3.jpeg',
        'images/etablissement/benahmed/BENAHMED4.jpeg',
        'images/etablissement/benahmed/BENAHMED5.jpeg',
        'images/etablissement/benahmed/BENAHMED6.jpeg',
        'images/etablissement/benahmed/BENAHMED7.jpeg',
        'images/etablissement/benahmed/BENAHMED8.jpg',
        'images/etablissement/benahmed/BENAHMED9.jpg'
      ];
    } else if (e.id === 'cqp_oulad_mrah') {
      photos = [
        'images/etablissement/settat/CQP1.png',
        'images/etablissement/settat/CQP2.png',
        'images/etablissement/settat/CQP3.png',
        'images/etablissement/settat/CQP4.png'
      ];
    } else if (e.id === 'emfmbtp_settat') {
      photos = [
        'images/etablissement/btp/BTP1.jpg',
        'images/etablissement/btp/BTP2.png',
        'images/etablissement/btp/BTP3.jpg',
        'images/etablissement/btp/BTP4.jpeg',
        'images/etablissement/btp/BTP5.jpeg',
        'images/etablissement/btp/BTP6.jpeg',
        'images/etablissement/btp/BTP7.jpeg',
        'images/etablissement/btp/BTP8.jpeg',
        'images/etablissement/btp/BTP9.jpeg',
        'images/etablissement/btp/BTP10.jpeg',
        'images/etablissement/btp/BTP11.jpeg',
        'images/etablissement/btp/BTP12.jpeg',
        'images/etablissement/btp/BTP13.jpeg',
        'images/etablissement/btp/BTP14.jpeg'  
      ];
    } else if (e.id === 'ista1_settat') {
      photos = [
        'images/etablissement/settat/ista1_5.jpeg',
        'images/etablissement/settat/ista1_3.jpeg',
        'images/etablissement/settat/ista1_4.jpeg',
        'images/etablissement/settat/ista1_6.jpeg',
        'images/etablissement/settat/ista1_7.jpeg',
        'images/etablissement/settat/ista1_8.jpeg',
        'images/etablissement/settat/ista1_9.jpeg',
        'images/etablissement/settat/ista1_1.jpeg',
        'images/etablissement/settat/ista1_2.jpeg',
      ];
    }
    else if (e.id === 'ista2_settat') {
      photos = [

        'images/etablissement/settat/ISTA2_8.jpeg',
        'images/etablissement/settat/ISTA2_7.jpeg',
        'images/etablissement/settat/ISTA2_6.jpeg',
        'images/etablissement/settat/ISTA2_5.jpeg',
        'images/etablissement/settat/ISTA2_4.jpeg',
        'images/etablissement/settat/ISTA2_3.jpeg',
        'images/etablissement/settat/ISTA2_2.jpeg',
        'images/etablissement/settat/ISTA2_1.jpeg'
      ];
    }
    else if (e.id === 'centre_mixte_settat') {
      photos = [
        'images/etablissement/settat/CM1.jpg',
        'images/etablissement/settat/CM2.jpeg',
        'images/etablissement/settat/CM3.jpeg',
        'images/etablissement/settat/CM4.jpeg',
        'images/etablissement/settat/CM5.jpeg',
        'images/etablissement/settat/CM6.jpg',
        'images/etablissement/settat/CM7.jpg',
        'images/etablissement/settat/CM8.jpg',
        'images/etablissement/settat/CM9.jpg',
        'images/etablissement/settat/CM10.jpg',
        'images/etablissement/settat/CM11.jpg',
        'images/etablissement/settat/CM12.jpg',
        'images/etablissement/settat/CM13.jpg'
      ];
    }

    if (photos.length) {
      M.elbWrap.style.display = 'block';
    } else {
      M.elbWrap.style.display = 'none';
    }

    // Set slider photos
    setSliderPhotos(photos, e.image, e.name);
  } else {
    // cas o√π la galerie n'existe pas dans le DOM (s√©curit√©)
    setSliderPhotos([], e.image, e.name);
  }

  modal.classList.add('show');
  modal.setAttribute('aria-hidden','false');
  document.documentElement.style.overflow='hidden';
  document.body.classList.add('modal-open');
  
  const footer = document.querySelector('.footer-ofppt');
  const chatbot = document.querySelector('#chatbot-container');
  if (footer) footer.style.display = 'none';
  if (chatbot) chatbot.style.display = 'none';
}

function closeModal(){
  modal.classList.remove('show');
  modal.setAttribute('aria-hidden','true');
  document.documentElement.style.overflow = '';
  document.body.classList.remove('modal-open');
  
  const footer = document.querySelector('.footer-ofppt');
  const chatbot = document.querySelector('#chatbot-container');
  if (footer) footer.style.display = 'block';
  if (chatbot) chatbot.style.display = 'block';
}

// Lightbox pour la galerie + image du slider
if (M.lb && M.lbImg) {
  // Open lightbox when clicking on the main image
  document.addEventListener('click', (ev) => {
    const mainImgClick = ev.target.closest && ev.target.closest('.preview-img.large-preview');
      
    if (mainImgClick) {
      const img = ev.target.closest('img');
      M.lbImg.src = img.src;
      M.lb.classList.add('show');
      document.body.style.overflow = 'hidden';
    } else if (ev.target === M.lb) {
      closeLightbox();
    }
  });

  // Close lightbox with close button
  if (M.lightboxClose) {
    M.lightboxClose.addEventListener('click', closeLightbox);
  }

  // Navigate in lightbox with buttons
  if (M.lightboxPrev && M.lightboxNext) {
    M.lightboxPrev.addEventListener('click', () => {
      if (!currentPhotos.length) return;
      currentPhotoIndex = (currentPhotoIndex - 1 + currentPhotos.length) % currentPhotos.length;
      M.lbImg.src = currentPhotos[currentPhotoIndex];
    });

    M.lightboxNext.addEventListener('click', () => {
      if (!currentPhotos.length) return;
      currentPhotoIndex = (currentPhotoIndex + 1) % currentPhotos.length;
      M.lbImg.src = currentPhotos[currentPhotoIndex];
    });
  }

  // Keyboard navigation for lightbox
  document.addEventListener('keydown', (ev) => {
    if (M.lb.classList.contains('show')) {
      if (ev.key === 'Escape') {
        closeLightbox();
      } else if (ev.key === 'ArrowLeft') {
        if (M.lightboxPrev) M.lightboxPrev.click();
      } else if (ev.key === 'ArrowRight') {
        if (M.lightboxNext) M.lightboxNext.click();
      }
    }
  });
}

function closeLightbox() {
  M.lb.classList.remove('show');
  M.lbImg.src = '';
  document.body.style.overflow = '';
}

// Tabs
const tabs = document.querySelectorAll('.tab');
const contents = document.querySelectorAll('.tab-content');
tabs.forEach(tab => {
  tab.addEventListener('click', () => {
    tabs.forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    contents.forEach(c => c.classList.remove('active'));
    document.querySelector(tab.dataset.target).classList.add('active');
    window.scrollTo({ top: 200, behavior: 'smooth' });
  });
});

// Card animation + r√©sum√© auto
const cards = document.querySelectorAll('.card');
const observer = new IntersectionObserver(entries => {
  entries.forEach(entry => { if (entry.isIntersecting) entry.target.classList.add('visible'); });
}, { threshold: 0.2 });
cards.forEach(card => observer.observe(card));

document.addEventListener('DOMContentLoaded', () => {
  document.querySelectorAll('.card[data-etab]').forEach(card => {
    card.classList.add('visible');
    const id = card.getAttribute('data-etab');
    const etab = DATA.find(x=>x.id === id);
    if (!etab) return;
    let p = card.querySelector('p');
    if (!p) {
      p = document.createElement('p');
      card.appendChild(p);
    }
    p.textContent = etab.summary || etab.name;
  });
});

// Click / clavier
document.addEventListener('click', (ev)=>{
  const card = ev.target.closest && ev.target.closest('.card[data-etab]');
  if(!card) return;
  openById(card.getAttribute('data-etab'));
});
document.addEventListener('keydown', (ev)=>{
  if(ev.key!=='Enter') return;
  const el = document.activeElement;
  if(el && el.matches('.card[data-etab]')) openById(el.getAttribute('data-etab'));
});
backdrop.addEventListener('click', closeModal);
closeBtn.addEventListener('click', closeModal);
document.addEventListener('keydown', e=>{ if(e.key==='Escape') closeModal(); });
</script>

<div id="chatbot-container">
  <div id="chatbot-bubble" title="Discuter avec nous">
    <i class="fa-solid fa-comments"></i>
  </div>

  <div class="chatbot-card" id="chatbot-card">
    <div class="chatbot-header">
      <h4><i class="fa-solid fa-robot"></i> Assistance OFPPT Settat</h4>
      <button id="close-chatbot" aria-label="Fermer le chatbot">&times;</button>
    </div>
    <iframe src="http://127.0.0.1:5000" title="Chatbot OFPPT" class="chatbot-frame"></iframe>
  </div>
</div>

<script>
  const chatbotBubble = document.getElementById("chatbot-bubble");
  const chatbotCard = document.getElementById("chatbot-card");
  const closeChatbot = document.getElementById("close-chatbot");

  if (chatbotBubble && chatbotCard && closeChatbot) {
    chatbotBubble.addEventListener("click", () => {
      chatbotCard.classList.toggle("visible");
    });

    closeChatbot.addEventListener("click", () => {
      chatbotCard.classList.remove("visible");
    });
  }
</script>
</body>
</html>